<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Transform Transitions</title>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?2.5.0"></script>
    <style type="text/css">

body {
  margin: 5px;
}

rect {
  stroke: #fff;
  stroke-width: 2px;
}

    </style>
  </head>
  <body>
    <script type="text/javascript">

var w = 280,
    h = 200,
    z = 40,
    x = w / z,
    y = h / z;

var svg = d3.select("body").append("svg:svg")
    .attr("width", w)
    .attr("height", h);

svg.selectAll("rect")
    .data(d3.range(x * y))
  .enter().append("svg:rect")
    .attr("transform", translate)
    .attr("width", z)
    .attr("height", z)
    // .style("fill", d3.scale.pow().domain([0, x * y]).range(["#163169", "#ddd"]));
    .style("fill", function(d) {
        var xmid = Math.ceil(x / 2);
        var col = d % x;
        var ymid = Math.floor(y / 2);
        var row = Math.floor(d / x);
        // return col < xmid ? d3.interpolateRgb("#ddd","#163169")(col / xmid) : d3.interpolateRgb("#163169","#ddd")(col / x)
        return row <= ymid ? d3.interpolateRgb("#ddd","#163169")(row / ymid) : d3.interpolateRgb("#163169","#ddd")(row / y)
    });

function translate(d) {
  return "translate(" + (d % x) * z + "," + Math.floor(d / x) * z + ")";
}

// function mouseover() {
//   this.parentNode.appendChild(this);
//   d3.select(this).transition()
//       .duration(500)
//       .style("fill-opacity", .5);
//     .transition()
//       .delay(1000)
//       .style("fill-opacity", 1);
// }

function fadeMe() {
  this.parentNode.appendChild(this);
  d3.select(this).transition()
      // .delay(function () { return Math.round(Math.random() * 1000); })
      .duration(function() { return Math.round(Math.random() * 2000) + 1500; })
      .style("fill-opacity", 0.5)
    .transition()
      .delay(2500)
      // .duration(2500)
      .style("fill-opacity", 1);
}

function autoRnd() {
  var sel1 = Math.round(Math.random() * x * y);
  var sel2 = Math.round(Math.random() * x * y);
  // var ySel = Math.random() * y;
  d3.selectAll("rect").transition()
      .delay(function () { return Math.round(Math.random() * 250); })
      .duration(2500)
      .style("fill-opacity", function(d) { return d == sel1 || d == sel2 ? 0.5 : 1 })
    .transition()
      .delay(2500)
      .style("fill-opacity", 1);
}

function pickNode() {
  d3.selectAll("rect")
    .filter(function(d) { return d == Math.round(Math.random() * x * y); })
    .each(fadeMe);
}

window.setInterval(pickNode, 2000);
    </script>
  </body>
</html>
